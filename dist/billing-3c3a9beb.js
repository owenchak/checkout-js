"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[876],{48574:(e,t,n)=>{n.r(t),n.d(t,{default:()=>R});var s=n(86940),r=n(91074),i=n(67627),o=n(95593),d=n(88870),a=n(49890),l=n(55409),u=n(70140),c=n(74161),m=n(98119),g=n(45855),h=n(41957);function p(e){var t=(0,h.Z)(e);return t&&["amazonpay"].indexOf(t.providerId)>-1?t.providerId:void 0}var f=n(76417),A=n(19686),v=n(97204),C=n(24648),y=n(53537),E=n(96543),Z=n(34323),b=n(17175),S=n(43276),k=n(67570),F=n(60452),w=n(16206),U=n(78379),B=n(77683),I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isResettingAddress:!1},t.addressFormRef=(0,i.createRef)(),t.handleSelectAddress=function(e){return(0,s.mG)(t,void 0,void 0,(function(){var t,n,r,i;return(0,s.Jh)(this,(function(s){switch(s.label){case 0:t=this.props,n=t.updateAddress,r=t.onUnhandledError,this.setState({isResettingAddress:!0}),s.label=1;case 1:return s.trys.push([1,3,4,5]),[4,n(e)];case 2:return s.sent(),[3,5];case 3:return(i=s.sent())instanceof Error&&r(i),[3,5];case 4:return this.setState({isResettingAddress:!1}),[7];case 5:return[2]}}))}))},t.handleUseNewAddress=function(){t.handleSelectAddress({})},t}return(0,s.ZT)(t,e),t.prototype.render=function(){var e=this.props,t=e.googleMapsApiKey,n=e.billingAddress,s=e.countriesWithAutocomplete,r=e.customer,o=r.addresses,d=r.isGuest,a=e.getFields,l=e.countries,c=e.isUpdating,m=e.setFieldValue,h=e.shouldShowOrderComments,p=e.values,f="amazonpay"===e.methodId,A=a(p.countryCode),E=A.filter((function(e){return e.custom})),Z=E.length>0,b=f&&Z?E:A,S=this.state.isResettingAddress,I=o&&o.length>0,M=n&&(0,v.Z)(n,o,a(n.countryCode));return i.createElement(w.Z,{autoComplete:"on"},f&&n&&i.createElement("div",{className:"form-fieldset"},i.createElement(B.Z,{address:n})),i.createElement(U.Z,{id:"checkoutBillingAddress",ref:this.addressFormRef},I&&!f&&i.createElement(U.Z,{id:"billingAddresses"},i.createElement(g.Z,{isLoading:S},i.createElement(C.Z,{addresses:o,onSelectAddress:this.handleSelectAddress,onUseNewAddress:this.handleUseNewAddress,selectedAddress:M?n:void 0}))),!M&&i.createElement(g.Z,{isLoading:S},i.createElement(y.Z,{countries:l,countriesWithAutocomplete:s,countryCode:p.countryCode,formFields:b,googleMapsApiKey:t,setFieldValue:m,shouldShowSaveAddress:!d}))),h&&i.createElement(k.Z,null),i.createElement("div",{className:"form-actions"},i.createElement(F.ZP,{disabled:c||S,id:"checkout-billing-continue",isLoading:c||S,type:"submit",variant:F.Wu.Primary},i.createElement(u.Z,{id:"common.continue_action"}))))},t}(i.PureComponent);const M=(0,S.Z)((0,f.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){var t=e.getFields,n=e.customerMessage,r=e.billingAddress;return(0,s.pi)((0,s.pi)({},(0,E.Z)(t(r&&r.countryCode),r)),{orderComment:n})},isInitialValid:function(e){var t=e.billingAddress,n=e.getFields,s=e.language;return!!t&&(0,Z.Z)({language:s,formFields:n(t.countryCode)}).isValidSync(t)},validationSchema:function(e){var t=e.language,n=e.getFields;return"amazonpay"===e.methodId?(0,A.Vo)((function(e){return(0,b.Z)({translate:(0,Z.w)(t),formFields:n(e&&e.countryCode)})})):(0,A.Vo)((function(e){return(0,Z.Z)({language:t,formFields:n(e&&e.countryCode)})}))},enableReinitialize:!0})(I));var z=n(72398),N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSubmit=function(e){return(0,s.mG)(t,void 0,void 0,(function(){var t,n,r,i,a,l,u,c,m,g,h=e.orderComment,p=(0,s._T)(e,["orderComment"]);return(0,s.Jh)(this,(function(e){switch(e.label){case 0:t=this.props,n=t.updateAddress,r=t.updateCheckout,i=t.customerMessage,a=t.billingAddress,l=t.navigateNextStep,u=t.onUnhandledError,(0,t.emitAnalyticsEvent)(z.O.BillingEntered),c=[],(m=(0,o.Z)(p))&&!(0,d.Z)(m,a)&&c.push(n(m)),i!==h&&c.push(r({customerMessage:h})),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,Promise.all(c)];case 2:return e.sent(),l(),[3,4];case 3:return(g=e.sent())instanceof Error&&u(g),[3,4];case 4:return[2]}}))}))},t}return(0,s.ZT)(t,e),t.prototype.componentDidMount=function(){return(0,s.mG)(this,void 0,void 0,(function(){var e,t,n,i,o,d;return(0,s.Jh)(this,(function(s){switch(s.label){case 0:e=this.props,t=e.initialize,n=e.onReady,i=void 0===n?r.noop:n,o=e.onUnhandledError,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,t()];case 2:return s.sent(),i(),[3,4];case 3:return(d=s.sent())instanceof Error&&o(d),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this.props,t=e.updateAddress,n=e.isInitializing,r=(0,s._T)(e,["updateAddress","isInitializing"]);return i.createElement("div",{className:"checkout-form"},i.createElement("div",{className:"form-legend-container"},i.createElement(m.Z,{testId:"billing-address-heading"},i.createElement(u.Z,{id:"billing.billing_address_heading"}))),i.createElement(g.Z,{isLoading:n,unmountContentWhenLoading:!0},i.createElement(M,(0,s.pi)({},r,{onSubmit:this.handleSubmit,updateAddress:t}))))},t}(i.Component);const R=(0,a.Z)((function(e){var t=e.checkoutService,n=e.checkoutState,s=n.data,r=s.getCheckout,i=s.getConfig,o=s.getCart,d=s.getCustomer,a=s.getBillingAddress,u=s.getBillingAddressFields,m=s.getBillingCountries,g=n.statuses,h=g.isLoadingBillingCountries,f=g.isUpdatingBillingAddress,A=g.isUpdatingCheckout,v=i(),C=d(),y=r(),E=o();if(!(v&&C&&y&&E))return null;var Z=v.checkoutSettings,b=Z.enableOrderComments,S=Z.googleMapsApiKey,k=["US","CA","AU","NZ"];return Z.features["CHECKOUT-4183.checkout_google_address_autocomplete_uk"]&&k.push("GB"),{billingAddress:a(),countries:m()||l.L,countriesWithAutocomplete:k,customer:C,customerMessage:y.customerMessage,getFields:u,googleMapsApiKey:S,initialize:t.loadBillingAddressFields,isInitializing:h(),isUpdating:f()||A(),methodId:p(y),shouldShowOrderComments:b&&(0,c.Z)(E)<1,updateAddress:t.updateBillingAddress,updateCheckout:t.updateCheckout}}))(N)}}]);
//# sourceMappingURL=billing-3c3a9beb.js.map